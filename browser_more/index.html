<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"a.biugle.cn",root:"/",scheme:"Gemini",version:"8.0.0",exturl:!0,sidebar:{position:"left",display:"post",padding:15,offset:15},copycode:!0,bookmark:{enable:!1,color:"#222",save:"manual"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:"valine",storage:!0,lazyload:!0,nav:null,activeClass:"valine"},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"fadeIn",post_body:"fadeIn",coll_header:"fadeIn",sidebar:"fadeIn"}},prism:!1,i18n:{placeholder:"搜索一下噜(biugle.cn)...",empty:"没有找到任何搜索结果：${query}",hits_time:"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）",hits:"找到 ${hits} 个搜索结果"},path:"search.xml",localsearch:{enable:!0,trigger:"manual",top_n_per_article:-1,unescape:!0,preload:!0}}</script><meta name="description" content="从浏览器的基础知识到页面的渲过程与优化"><meta property="og:type" content="article"><meta property="og:title" content="关于浏览器的那些事儿"><meta property="og:url" content="http://a.biugle.cn/browser_more/"><meta property="og:site_name" content="江湖小栈"><meta property="og:description" content="从浏览器的基础知识到页面的渲过程与优化"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="og:image" content="http://a.biugle.cn/images/loading.gif"><meta property="article:published_time" content="2020-12-21T14:16:15.000Z"><meta property="article:modified_time" content="2025-02-25T02:39:59.699Z"><meta property="article:author" content="DoubleAm"><meta property="article:tag" content="浏览器"><meta property="article:tag" content="Web优化"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://a.biugle.cn/images/loading.gif"><link rel="canonical" href="http://a.biugle.cn/browser_more/"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><meta name="keywords" content="关于浏览器的那些事儿,浏览器内核,浏览器渲染,浏览器的性能优化,浏览器的兼容性优化"><link rel="shortcut icon" href="/images/favicon.png"><script type="text/javascript">function setWords(){document.getElementById("api-iframe").src="https://cdn.biugle.cn/api.html"}window.addEventListener("message",e=>{var a=unescape(e.data.value);switch(e.data.type){case"word":$("#words").text(a);break;case"image":$("#morethinks-div .img-div").attr("style",`background-image: url(${a})`);break;case"avatar":$(".site-author-image").attr("src",a)}})</script><title>关于浏览器的那些事儿 | 江湖小栈</title><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">江湖小栈</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Do Better</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fas fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fas fa-archive fa-fw"></i>归档<span class="badge">113</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fas fa-th fa-fw"></i>分类<span class="badge">16</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fas fa-tags fa-fw"></i>标签<span class="badge">110</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fas fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-leavewords"><a href="/liuyan/" rel="section"><i class="fas fa-book fa-fw"></i>留言</a></li><li class="menu-item menu-item-others"><a href="/others/" rel="section"><i class="fas fa-american-sign-language-interpreting fa-fw"></i>其他</a></li><li class="menu-item menu-item-bibi"><a href="/bibi" rel="section"><i class="fas fa-toilet-paper fa-fw"></i>纸条</a></li><li class="menu-item menu-item-biugle"><span class="exturl" data-url="aHR0cDovL2JpdWdsZS5jbg=="><i class="fas fa-paper-plane fa-fw"></i>导航</span></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索一下噜(biugle.cn)..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><section class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E6%B5%81%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AF%B9%E6%AF%94%E4%B8%8E%E5%8F%91%E5%B1%95"><span class="nav-number">1.</span> <span class="nav-text">主流浏览器对比与发展</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E5%8E%9F%E7%90%86"><span class="nav-number">2.</span> <span class="nav-text">浏览器的原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%A8%8B%E5%BA%8F%E7%BB%93%E6%9E%84"><span class="nav-number">2.1.</span> <span class="nav-text">浏览器程序结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%A8%8B%E5%BA%8F%E7%BB%93%E6%9E%84%E5%8F%91%E5%B1%95"><span class="nav-number">2.2.</span> <span class="nav-text">浏览器程序结构发展</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E4%B8%BB%E6%B5%81%E7%A8%8B"><span class="nav-number">2.3.</span> <span class="nav-text">渲染主流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B"><span class="nav-number">3.</span> <span class="nav-text">浏览器的页面渲染过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2%E7%9A%84%E4%BC%98%E5%8C%96"><span class="nav-number">4.</span> <span class="nav-text">浏览器页面的优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">4.1.</span> <span class="nav-text">性能优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%BC%E5%AE%B9%E6%80%A7%E4%BC%98%E5%8C%96"><span class="nav-number">4.2.</span> <span class="nav-text">兼容性优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%9D%A5%E6%BA%90"><span class="nav-number">5.</span> <span class="nav-text">参考来源</span></a></li></ol></div></section><section class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="DoubleAm" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">DoubleAm</p><div class="site-description" itemprop="description">山中何事？松花酿酒，春水煎茶。</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">113</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">110</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhbmRhb2g=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;pandaoh"><i class="fab fa-github fa-fw"></i></span> </span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly93ZWliby5jb20vaGV4aW9uZ2JpYW8=" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;hexiongbiao"><i class="fab fa-weibo fa-fw"></i></span> </span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL35kb3VibGVhbQ==" title="NPM → https:&#x2F;&#x2F;www.npmjs.com&#x2F;~doubleam"><i class="fab fa-npm fa-fw"></i></span> </span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjk2MDYxMDU4" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;296061058"><i class="fas fa-bold fa-fw"></i></span> </span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOjEwMDU3NjA2OTRAcXEuY29t" title="E-Mail → mailto:1005760694@qq.com"><i class="fas fa-envelope fa-fw"></i></span></span></div><div class="links-of-blogroll animated"><div class="links-of-blogroll-title"><i class="fas fa-globe fa-fw"></i> 收藏夹</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="/resume" title="&#x2F;resume">resume</a></li><li class="links-of-blogroll-item"><a href="/md_online" title="&#x2F;md_online">编辑器</a></li><li class="links-of-blogroll-item"><a href="/others/notebooks" title="&#x2F;others&#x2F;notebooks">记事板</a></li><li class="links-of-blogroll-item"><a href="/tap" title="&#x2F;tap">解压神器</a></li><li class="links-of-blogroll-item"><a href="/otherlinks" title="&#x2F;otherlinks">友情链接</a></li></ul></div><div id="words" onclick="setWords()">Leo He</div></section></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://a.biugle.cn/browser_more/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="DoubleAm"><meta itemprop="description" content="山中何事？松花酿酒，春水煎茶。"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="江湖小栈"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">关于浏览器的那些事儿</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-12-21 22:16:15" itemprop="dateCreated datePublished" datetime="2020-12-21T22:16:15+08:00">2020-12-21</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%B9%BF%E5%9E%83%E5%9C%BE/" itemprop="url" rel="index"><span itemprop="name">湿垃圾</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fas fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Hot°C：</span> <a title="valine" href="/browser_more/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/browser_more/" itemprop="commentCount"></span> </a></span><span class="post-meta-item"><i class="fas fa-newspaper jingping">&nbsp;精品文章</i></span></div><div class="post-meta"><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>7.5k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>7 分钟</span></span></div><div class="post-description">从浏览器的基础知识到页面的渲过程与优化</div></div></header><div class="post-body" itemprop="articleBody"><div class="note warning no-icon"><p>东拼西凑了一些浏览器内容(^-^)</p></div><span id="more"></span><p><img data-src="/images/loading.gif" data-original="/browser_more/geng.jpg"></p><h2 id="主流浏览器对比与发展"><a href="#主流浏览器对比与发展" class="headerlink" title="主流浏览器对比与发展"></a>主流浏览器对比与发展</h2><ul><li>推荐一个<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMXg1NHkxQjdSRQ==">短视频介绍<i class="fa fa-external-link-alt"></i></span></li></ul><table><thead><tr><th align="center"><strong>浏览器/参数</strong></th><th align="center"><strong>厂商</strong></th><th align="center"><strong>内核</strong></th><th align="center"><strong>JS引擎</strong></th><th><strong>其他</strong></th></tr></thead><tbody><tr><td align="center"><code>Chrome</code></td><td align="center">Google</td><td align="center">Chromium、<br>Blink</td><td align="center">V8</td><td><code>-webkit-</code></td></tr><tr><td align="center"><code>Safari</code></td><td align="center">Apple</td><td align="center">Webkit</td><td align="center">JScore、<br>SquirrelFish(Nitro)(4.0+)</td><td><code>-webkit-</code></td></tr><tr><td align="center"><code>FireFox</code></td><td align="center">Mozilla</td><td align="center">Gecko</td><td align="center">SpiderMonkey(1.0-3.0)、<br>TraceMonkey(3.5-3.6)、<br>JaegerMonkey(4.0+)</td><td><code>-moz-</code></td></tr><tr><td align="center"><code>Opera</code></td><td align="center">OperaSoftware</td><td align="center">Presto、<br>Webkit、<br>Blink</td><td align="center">Linear A(4.0-6.1)、<br>Linear B(7.0-9.2)、<br>Futhark(9.5-10.2)、<br>Carakan(10.5-)</td><td><code>-o-</code></td></tr><tr><td align="center"><code>IE</code></td><td align="center">Microsoft</td><td align="center">Trident</td><td align="center">JScript(IE9-)、<br>Chakra(IE9+)</td><td><code>-ms-</code></td></tr><tr><td align="center"><code>Edge</code></td><td align="center">Microsoft</td><td align="center">EdgeHTML</td><td align="center">Chakra</td><td><code>-ms-</code></td></tr><tr><td align="center"><code>新Edge</code></td><td align="center">Microsoft</td><td align="center">Chromium</td><td align="center">V8</td><td><code>-webkit-</code></td></tr><tr><td align="center"><code>UC</code></td><td align="center">阿里巴巴</td><td align="center">U3</td><td align="center">U3集成?</td><td>同红芯浏览器一样换汤不换药</td></tr><tr><td align="center"><code>360/QQ/搜狗/猎豹</code>、<br><code>百度/2345/傲游/世界之窗</code></td><td align="center">见下文</td><td align="center">Trident(兼容模式)+Webkit(高速模式)双内核</td><td align="center">/</td><td>能用就行</td></tr></tbody></table><ol><li>Chrome 以前是 Chromium 内核(Chrome 内核)，在 Webkit 基础上修改，但代码可读性更高，比 Webkit 更好用。目前是使用重新升级换代后的 Blink 内核。谷歌还开发了自己的 JS 引擎 V8，使 JS 运行速度极大地提高，<strong>Node.js</strong> 也是以 V8 为底层架构封装。另外我们可以通过在地址栏输入 <code>chrome://version/</code> 来查看浏览器相关信息，通过 <code>chrome://dino</code> 玩小游戏。</li><li>Safari 的 Webkit 源自 KHTML，苹果在比较了 Gecko 和 KHTML 后，选择了后者来做引擎开发，是因为 KHTML 拥有清晰的源码结构和极快的渲染速度。苹果与谷歌冲突又研发使用 Webkit2 内核，谷歌则研发了 Chromium 内核，Webkit 也算是苹果为业界做出的最大贡献。</li><li>FireFox 的 Gecko 内核俗称 Firefox 内核，代码完全公开，可开发程度高，全世界的程序员都可为其编写代码，增加其功能。还有一个 JS 引擎 Rhino，也是由Mozilla基金会管理，虽然最终被废弃，但其开放源代码，完全以Java编写。</li><li>Opera 最早自己研发 Presto，后面用 Webkit，最后与谷歌一起发布使用 Blink，然后因用户体验下降逐渐衰落。</li><li>IE 是微软和 Spyglass 合作开发，随 Windows 绑定抢占市场，并且只能在 Windows 使用也不开源。</li><li>Edge 原名叫斯巴达，后改名 Edge，2015 年 3 月发布第一个预览版。微软计划在 Windows 中完全淘汰 Internet Explorer 后，为 Edge 添加 “IE 模式”，该模式允许用户在 Edge 内使用 IE 内核重新加载网页。</li><li>新 Edge 是微软妥协下的产物，2018 年 12 月宣布新 Edge 将基于 Chromium 内核开发，正式版于 2020 年 1 月发布。可以通过 <code>edge://version/</code> 来查看浏览器版本信息，通过 <code>edge://surf/</code> 可以玩离线小游戏。</li><li>UC 浏览器的 U3 内核本质是基于开源内核 Webkit 开发，也有说是基于 Gecko 内核与 Trident 内核开发的。</li><li>众多国产浏览器的厂商分别为360安全、Tencent、搜狗信息、豹好玩科技、Baidu、二三四五、网际傲游、凤凰工作室。这些浏览器适合需要经常访问那种古老系统的用户(兼容模式)</li></ol><p><img data-src="/images/loading.gif" data-original="/browser_more/browser_history.png"></p><blockquote><p>补充：还有一个 JS 引擎 - KJS，KDE 的 ECMAScript／JavaScript 引擎，最初由哈里·波顿开发，用于 KDE 项目的 Konqueror 网页浏览器中。</p></blockquote><h2 id="浏览器的原理"><a href="#浏览器的原理" class="headerlink" title="浏览器的原理"></a>浏览器的原理</h2><h3 id="浏览器程序结构"><a href="#浏览器程序结构" class="headerlink" title="浏览器程序结构"></a>浏览器程序结构</h3><ul><li>用户界面(User Interface) - 包括地址栏、前进/后退按钮、书签菜单等。除了浏览器主窗口（显示页面），其他部分都属于用户界面。</li><li>浏览器引擎(Browser Engine) - 在用户界面和渲染引擎之间传送指令。</li><li>渲染引擎(Rendering Engine) - 显示（渲染）请求的内容。如果请求的内容是 HTML，它就负责解析 HTML 和 CSS 内容，并将解析后的内容显示在屏幕上。</li><li>网络(NetWorking) - 用于网络调用，比如 HTTP 请求。其接口与平台无关，并为所有平台提供底层实现。</li><li>JavaScript 解释器(JavaScript Interpreter)。用于解析和执行 JavaScript 代码。</li><li>用户界面后端(UI Backend) - 用于绘制基本的窗口小部件，比如组合框和窗口。公开了与平台无关的通用接口，在底层使用操作系统的用户界面方法。</li><li>数据存储(Data Persistence) - 这是持久层。浏览器需要在硬盘上保存各种数据，例如 Cookie。新的 HTML 规范 (HTML5) 定义了“网络数据库”，这是一个完整（但是轻便）的浏览器内数据库。</li></ul><p><img data-src="/images/loading.gif" data-original="/browser_more/browser_a.png"></p><h3 id="浏览器程序结构发展"><a href="#浏览器程序结构发展" class="headerlink" title="浏览器程序结构发展"></a>浏览器程序结构发展</h3><ul><li>最早的浏览器上单进程结构，页面线程执行页面渲染，JS 线程执行 JS 代码等等，但是只要其中一个线程出问题，可能整个程序就崩溃了。<ul><li>例如：浏览器的一个标签页卡死，那么整个浏览器都无法使用，导致应用程序极其不稳定。</li><li>单进程是可以共享数据的，所以并不安全。</li><li>由于各个线程负责的任务过多，使用起来也并不流畅。</li></ul></li><li>为了解决这些问题，现代浏览器使用了多进程结构。可分为浏览器进程、网络进程、缓存进程、GPU 进程、渲染器进程、插件进程。<ul><li>浏览器进程：控制用户界面，协调其他进程工作。</li><li>网络进程：发起接收网络请求</li><li>缓存进程：控制数据缓存</li><li>GPU 进程：负责浏览器界面与页面的渲染</li><li>渲染器进程：控制 Tab 标签页的渲染，有可能会为每个标签页创建一个渲染进程(由浏览器启动模型决定)。独立每个页面一个进程可以起到进程隔离的作用，每个页面互不干扰。</li><li>插件进程：控制使用的插件，Flash等等，不是浏览器安装的插件。</li></ul></li></ul><h3 id="渲染主流程"><a href="#渲染主流程" class="headerlink" title="渲染主流程"></a>渲染主流程</h3><p><img data-src="/images/loading.gif" data-original="/browser_more/mainflow.png"></p><ol><li>浏览器从网络层获取请求的文档内容，然后开始渲染流程。</li><li>解析并开始构建 Content Tree（Element -&gt; DOM nodes），同时解析样式数据（外部 CSS 和 Style 元素）。</li><li>两者结合构建 Render Tree（渲染树包含带有视觉属性（如颜色和尺寸）的矩形们）。</li><li>在渲染树创建后进入 Layout 阶段，给渲染树的每个节点设置在屏幕上的位置信息。</li><li>Paint 阶段，通过 UI backend 绘制 Render tree 到屏幕。</li></ol><blockquote><p>注意，渲染过程是渐进式的。浏览器会尽早展示文档内容，即不会在所有 HTML 文档解析完成后才会去构建 Render tree，而是部分内容被解析和展示，并继续解析和展示剩下的。</p></blockquote><p><img data-src="/images/loading.gif" data-original="/browser_more/webkitflow.png" alt="Webkit"></p><p><img data-src="/images/loading.gif" data-original="/browser_more/geckoflow.jpg" alt="Gecko"></p><h2 id="浏览器的页面渲染过程"><a href="#浏览器的页面渲染过程" class="headerlink" title="浏览器的页面渲染过程"></a>浏览器的页面渲染过程</h2><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvUGVyZm9ybWFuY2UvSG93X2Jyb3dzZXJzX3dvcms=">参考文章<i class="fa fa-external-link-alt"></i></span></p></blockquote><hr><ul><li>在浏览器地址栏输入 URL</li></ul><hr><ul><li>浏览器会启动网络线程来请求 DNS 进行域名解析，最终返回一个 IP 地址。<br><img data-src="/images/loading.gif" data-original="/browser_more/dns.jpg"></li></ul><hr><ul><li>一旦获取到服务器IP地址，浏览器就会通过TCP【三次握手】与服务器建立连接。这个机制的是用来让两端尝试进行通信。浏览器和服务器在发送数据之前，通过上层协议 HTTPS 可以协商网络 TCP 套接字连接的一些参数。TCP的【三次握手】技术经常被称为【SYN-SYN-ACK】，更确切的说是 【SYN, SYN-ACK, ACK】，因为通过 TCP 首先发送了三个消息进行协商，开始一个 TCP 会话在两台电脑之间。这意味着服务器之间还要来回发送三条消息，而我们的请求目前尚未发出。<ul><li><img data-src="/images/loading.gif" data-original="/browser_more/net_mod.png" alt="OSI与TCP/IP模型"></li><li><img data-src="/images/loading.gif" data-original="/browser_more/tcp_hands.png" alt="三次握手"></li><li>上图我们可以这样理解，因为 TCP 是一个工作在传输层的可靠数据传输的服务，它能确保接收端接收的网络包是无损坏、无间隔、非冗余和按序的。<ul><li>面向连接：一定是「一对一」才能连接，不能像 UDP 协议可以一个主机同时向多个主机发送消息，也就是一对多是无法做到的。</li><li>可靠的：无论的网络链路中出现了怎样的链路变化，TCP 都可以保证一个报文一定能够到达接收端。</li><li>字节流：消息是「没有边界」的，所以无论我们消息有多大都可以进行传输。并且消息是「有序的」，当「前一个」消息没有收到的时候，即使它先收到了后面的字节，那么也不能扔给应用层去处理，同时对「重复」的报文会自动丢弃。</li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuaWJhbm1lbi5jb20vcG9zdHMvMzc1YjlkNGUuaHRtbA==">参考：ibanmen<i class="fa fa-external-link-alt"></i></span></li></ul></li><li>TCP 是面向连接的协议，所以使用 TCP 前必须先建立连接，而建立连接是通过三次握手来进行的，简单解释上图可以是：<ol><li>我对你说：我要跟你说话。（此时服务端确认客户端的发送能力没有问题）</li><li>你跟我说：我知道你要跟我说话，我们开始说话吧。（此时客户端确认服务端的接收和发送能力都没有问题）</li><li>我跟你说：好的，我们开始说话吧。（此时服务端确认客户端的接收能力也没有问题）</li></ol></li></ul></li></ul><hr><ul><li>TLS/SSL 协商：为了在【HTTPS】上建立安全连接，另一种握手是必须的。更确切的说是 TLS/SSL 协商，它决定了什么密码将会被用来加密通信，验证服务器，这就意味着在进行真实的数据传输之前建立安全连接。在发送真正的请求内容之前还需要三次往返服务器。虽然建立安全连接对增加了加载页面的等待时间，对于建立一个安全的连接来说，以增加等待时间为代价是值得的，因为在浏览器和 web 服务器之间传输的数据不可以被第三方解密。<br><img data-src="/images/loading.gif" data-original="/browser_more/ssl.jpg"></li></ul><hr><ul><li>经过上图 8 次往返，浏览器终于可以发出请求。一旦我们建立了到 web 服务器的连接，浏览器就代表用户发送一个初始的 HTTP GET请求，对于网站来说，这个请求通常是一个 HTML 文件。</li></ul><hr><ul><li>一旦服务器收到请求，它将使用相关的响应头和 HTML 的内容进行回复。此时网络线程会通知 UI 线程执行后续操作。<br><img data-src="/images/loading.gif" data-original="./httpflow.jpg" alt="HTTP 信息流"></li></ul><hr><ul><li>UI 线程会创建一个渲染器进程来渲染页面，浏览器进程会通过 IPC 管道将数据传递给渲染器进程。</li></ul><hr><ul><li>渲染器进程的主线程接收到数据(HTML)，开始渲染解析。</li></ul><hr><ul><li>通过标签词法解析，将内容解析为多个标记，然后构造 DOM 树，先创建 document 对象，再不断修改，向其中添加各种元素。<ul><li>解析引入的 css、js、img 等等，图片与 css 不会阻塞 HTML 的解析，因为不影响 DOM 树的构造。但 <code>&lt;script&gt;</code> 标签会阻塞 HTML 的解析，转而执行其中的 js 代码，因为浏览器不清楚此 js 代码是否有改变 DOM 结构，所以先行执行。</li></ul></li></ul><hr><ul><li>构建 DOM 树后，主线程开始解析 css 并确定每个 DOM 节点的样式，即使我们没写样式，每个浏览器都有自己的样式表。</li></ul><hr><ul><li>构建 LayoutTree，通过 DOM 树和样式生成 LayoutTree，即确定每个节点的位置。LayoutTree 的每个节点都记录了自己的坐标与边框尺寸等。<ul><li>DOM 树与 Layout 树并不是对应的，设置了 <code>display:none;</code> 的节点是不会在 Layout 树中。</li><li>有内容显示的伪元素节点不会出现在 DOM 树中，但会出现在 Layout 树中，因为 DOM 是通过 HTML 解析的，而伪元素是通过样式产生的。</li></ul></li></ul><hr><ul><li>渲染器进程的主线程遍历 LayoutTree 确定各个节点的绘制顺序，创建一个绘制记录表（Paint Record）。比如 <code>z-index</code> 值大的元素一般都是最后绘制等等。<br><img data-src="/images/loading.gif" data-original="/browser_more/mainflow.png"></li></ul><hr><ul><li>渲染器进程的主线程再遍历 LayoutTree 生成 Layer Tree。</li></ul><hr><ul><li>渲染器进程的主线程将 Layer Tree 与绘制顺序表一起传给合成器线程。<ol><li>合成器线程按规则进行分图层，并把图层生成更小的图块(tiles)再传递给栅格线程进行栅格化。</li><li>栅格化完成后返还给合成器线程 draw quads 图块信息(每图块的信息与位置等)。</li><li>合成器线程根据这些 draw quads 信息用 frame 合成器将合成一个合成器帧。</li><li>再通过 IPC 管道将此合成器帧传递给浏览器进程。</li><li>浏览器进程收到这帧的图像后传递给 GPU，GPU 渲染到页面上。</li></ol><ul><li>当你滚动页面时又会重新生成合成器帧，再次渲染到页面上。</li><li>当我们改变元素位置或尺寸属性时，会重新进行样式计算、布局、绘制等后面所有流程(重排-reflow)。</li><li>当我们只改变颜色这种属性时，不会引起重新触发布局，会触发样式计算与绘制(重绘-repaint)。</li><li>因为 JS 也是在主线程运行，所以尽量不要高频触发重绘重排，毕竟布局、绘制也是在占用主线程，高频触发重绘重排会导致页面掉帧。</li><li>所以尽量减少重绘重排，可以转而使用 CSS3 的 transform 动画来达到效果(会直接运行合成器线程)，这些是不会占用主线程的，能够避免重绘重排与 js 执行抢夺主线程导致页面卡顿掉帧的问题。</li><li>在移动端使用 3D 转换可以优化性能。如果设备有 3D 加速引擎 GPU 可以提高性能，2D 转换是无法调用 GPU，2D 是靠的 CPU。</li><li>也可以利用 <code>requestAnimationFrame()</code> API，利用浏览器的空闲时间来优化，React Fiber 就是使用此 API，他会将主线程的任务分散到每一帧的间隔，从而不影响动画的流程。</li></ul></li></ul><hr><ul><li>收到全部内容之后可以选择断开(根据 Connection 请求头，若为 keep-alive 则保持。)与服务器之间的 TCP 连接。<ul><li>我对你说：好了，我不想跟你说话了，再见。（客户端发送关闭连接请求给服务端）</li><li>你对我说：好的，那我要跟你再见啦。（服务端确认客户端的请求）</li><li>你对我说：现在我要跟你再见了，你知道了吗。（服务端请求关闭连接）</li><li>我对你说：我知道了，再见！（客户端确认请求）<br><img data-src="/images/loading.gif" data-original="/browser_more/tcp_over.jfif" alt="四次挥手"></li></ul></li></ul><hr><h2 id="浏览器页面的优化"><a href="#浏览器页面的优化" class="headerlink" title="浏览器页面的优化"></a>浏览器页面的优化</h2><h3 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h3><ul><li>减少 DNS 查找（使用 cdn 等）</li><li>js 延迟加载或异步加载</li><li>尽量使用 link，减少使用 @import，import 是最后挂载的。</li><li>减少 HTTP 请求（CSS Sprite、合并 css、合并 js 等等）</li><li>将 html/css/js/img 等文件压缩</li><li>开启 gzip 模块</li><li>善于开启并利用缓存，从缓存中读取图片与 html/css/js 等。</li><li>添加 Expires 头缓存<ul><li>页面的初次访问者会进行很多 HTTP 请求，但是通过使用一个长久的 Expires 头，可以使这些组件被缓存，下次访问的时候，就可以减少不必要的 HTPP 请求，从而提高加载速度。<ul><li>Web 服务器通过 Expires 头告诉客户端可以使用一个组件的当前副本，直到指定的时间为止。</li><li>例如：<code>Expires: Fri, 18 Mar 2016 07:41:53 GMT</code></li><li>Expires 缺点: 它要求服务器和客户端时钟严格同步，过期日期需要经常检查。</li><li>HTTP1.1 中引入 Cache-Control 来克服 Expires 头的限制，使用 max-age 指定组件被缓存多久。</li><li><code>Cache-Control: max-age=12345600</code></li><li>若同时制定 Cache-Control 和 Expires，则 max-age 将覆盖 Expires 头。</li></ul></li></ul></li><li>HTML 代码优化<ul><li>使用语义化的标签，代码清晰简洁。</li><li>使用 W3C 标准书写闭合小写的标签。</li><li>避免使用空请求，包括空的 href 链接、空 src 链接。空链接本身无法请求成功，因此会把一个 HTTP 请求拖到超时，而且空链接会阻塞页面中其他资源的下载进程，会拖慢页面加载速度。</li><li>根据项目大小，选择主要使用 class 还是 id。id 选择器优先级最高，访问速度最快。但是在 html 中每声明一个 id，就会在 js 底层声明一个全局变量，而全局变量的增多，将会拖慢 js 中变量遍历的效率，推荐项目小可以用 id，项目大少用 id。</li><li>预先设定图片与 table 大小，避免缩放。在页面加载过程中，图片最后加载，若不对图片预设大小，当图片加载完成后，将会引起大量的重排，将会浪费浏览器资源及拖慢页面加载速度。</li><li>尽量减少 DOM 元素的数量与层级。解析 HTML 时，标签的数量越多，标签的层级越深，浏览器解析构建 DOM 树的时间就越长，应尽可能的减少 DOM 元素的数量和层级。</li><li>尽量避免使用 table 标签。浏览器对 table 标签的解析是全部生成后再一次性绘制的，因此会造成表格位置较长时间的空白，推荐使用 ul 及 li 标签绘制表格。</li><li>使用异步加载 iframe 标签。浏览器加载 iframe 标签时，会阻塞父页面渲染树的构建及 HTTP 请求，因此尽量使用异步加载 iframe。</li></ul></li><li>CSS 代码优化<ul><li>禁止使用样式表达式，它的解析速度较慢，而且运算次数远比我们想象的要大，随意动动鼠标就能轻松达到上万次运算，会对页面性能造成影响。<ul><li>例如：<code>#myDiv&#123;width: expression(document.body.offsetWidth-110+&quot;px&quot;);&#125;</code>。</li></ul></li><li>优化关键选择器，去掉无效的父级选择器，尽量少在选择器末尾使用通配符。大多数人都认为，浏览器对 CSS 选择器的解析式从左往右进行的，但是其实是从右到左执行的。</li><li>减少无效代码，注意公用样式。</li></ul></li><li>JS 代码优化<ul><li>多个 js 变量声明合并。</li><li>不使用 eval 函数，不安全，性能消耗严重。</li><li>使用事件代理绑定事件，如将事件绑定到 body 上进行代理，利用冒泡原理将事件加到父级上，能够给动态增加的元素进行数据绑定。</li><li>避免频繁的操作 DOM 节点，使用 innerHTML 代替，从而减少重绘和重排。</li><li>减少全局变量，尽量使用局部变量。js 中全局变量运算速率远低于局部变量，速度差异达到上百倍，且全局变量越多，全局变量的查找速率便越慢。</li><li>减少 js 对 css 样式的修改从而减少重绘和重排。</li><li>减少 ajax 请求，常用数据存本地。</li></ul></li><li>LazyLoad Images</li></ul><h3 id="兼容性优化"><a href="#兼容性优化" class="headerlink" title="兼容性优化"></a>兼容性优化</h3><ul><li>HTML5 新的语义标签在低版本的老 IE 浏览器中存在兼容性问题，可以引入第三方解析库。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>使用 <a href="/cssmore">Reset CSS</a> 来统一浏览器样式</li><li>不用兼容 IE 时，直接<a href="/ietest">排除掉</a>。</li><li>写 CSS3 新样式属性时，加浏览器前缀兼容早期浏览器。</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span></span><br><span class="line">transform</span><br><span class="line">transtion</span><br><span class="line">animation</span><br><span class="line">border-radius</span><br><span class="line">box-shadow</span><br><span class="line">flex</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>避免使用不兼容的 js 代码（时间处理问题、屏幕宽高问题、event 事件问题、DOM 节点问题、事件传播问题、阻止默认事件问题、鼠标滚轮滚动事件问题等等）。</li><li>鼠标指针 <code>cursor: hand;</code> 只有 IE 浏览器识别，其他浏览器不识别。统一使用 <code>cursor: pointer;</code></li><li>超链接访问过后 hover 样式就不出现的问题，需要注意伪类顺序 <code>link-visited-hover-active</code>。</li><li>css hack</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background-color</span>: yellow0; // <span class="number">0</span> ie8</span><br><span class="line">+<span class="attribute">background-color</span>: pink; // + ie7</span><br><span class="line">_background-<span class="attribute">color</span>: orange; // _ ie6</span><br></pre></td></tr></table></figure><ul><li>使用一个功能之前判断浏览器是否支持，比如使用 ajax 要判断是否支持 XMLHttpRequest，IE6 之前不支持。还有使用本地存储、通知弹窗等 HTML5 新特性时更须注意。</li></ul><h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU2JUI1JThGJUU4JUE3JTg4JUU1JTk5JUE4JUU1JUJDJTk1JUU2JTkzJThFJUU2JUFGJTk0JUU4JUJFJTgzXyhIVE1MKQ==">参考 HTML 引擎<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvSmF2YVNjcmlwdCVFNSVCQyU5NSVFNiU5MyU4RQ==">参考 JavaScript 引擎<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuaHRtbDVyb2Nrcy5jb20vemgvdHV0b3JpYWxzL2ludGVybmFscy9ob3dicm93c2Vyc3dvcmsv">参考浏览器原理<i class="fa fa-external-link-alt"></i></span></li></ul></div><footer class="post-footer"><div><div style="text-align:center;color:#ccc;font-size:15px;padding:5px">----------文章已到底啦&nbsp;<i class="fas fa-heart"></i>&nbsp;感谢您的阅读----------</div></div><div class="reward-container"><div>给博主来杯卡布奇诺~</div><button onclick='document.querySelector(".post-reward").classList.toggle("active")'>打赏</button><div class="post-reward"><div><img src="/images/wechatpay.png" alt="DoubleAm 微信"> <span>微信</span></div><div><img src="/images/alipay.png" alt="DoubleAm 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>博主： </strong>DoubleAm</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="http://a.biugle.cn/browser_more/" title="关于浏览器的那些事儿">http://a.biugle.cn/browser_more/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div><div class="post-tags"><a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag"><i class="fa fa-tag"></i> 浏览器</a> <a href="/tags/Web%E4%BC%98%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> Web优化</a></div><div class="post-nav"><div class="post-nav-item"><a href="/sass_scss_less/" rel="prev" title="Sass(Scss)、Less的区别与选择 + 基本使用"><i class="fa fa-chevron-left"></i> Sass(Scss)、Less的区别与选择 + 基本使用</a></div><div class="post-nav-item"><a href="/xhttp_js/" rel="next" title="JavaScript 基于 Ajax 的 HTTP 请求工具封装">JavaScript 基于 Ajax 的 HTTP 请求工具封装 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="comments" id="valine-comments"></div><script>window.addEventListener("tabs:register",()=>{let t=CONFIG.comments.activeClass;var e;(t=CONFIG.comments.storage?localStorage.getItem("comments_active")||t:t)&&(e=document.querySelector(`a[href="#comment-${t}"]`))&&e.click()}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fas fa-heartbeat"></i> </span><span class="author" itemprop="copyrightHolder">DoubleAm</span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fas fa-user"></i> </span><span class="site-uv" title="游客"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fas fa-eye"></i> </span><span class="site-pv" title="阅读"><span id="busuanzi_value_site_pv"></span></span></span></div><iframe id="api-iframe" name="api" style="display:none"></iframe><script type="text/javascript">function createTime(){var t=new Date,e=new Date("05/28/2018 20:01:01"),r=(t-e)/1e3,a=Math.floor(r/60/60/24),o=Math.floor(r/60/60-24*a),r=Math.floor(r/60-1440*a-60*o),t=Math.floor((t-e)/1e3-86400*a-3600*o-60*r);1===String(o).length&&(o="0"+o),1===String(r).length&&(r="0"+r),1===String(t).length&&(t="0"+t),document.querySelector(".run-times").setAttribute("data-content"," 网站已孵化 "+a+" 天 "+o+" 小时 "+r+" 分钟 "+t+" 秒 ")}var siteTime;function timeFormat(t){var e,r,a,o,n=864e5,i=(new Date).getTime()-t;if(!(i<0))return e=Math.floor(i/6e4),r=Math.floor(i/36e5),n=Math.floor(i/n),o=Math.floor(i/6048e5),a=Math.floor(i/2592e6),result=1<=a&&a<=3?" "+parseInt(a)+" 月前":1<=o&&o<=4?" "+parseInt(o)+" 周前":1<=n&&n<=6?" "+parseInt(n)+" 天前":1<=r&&r<=23?" "+parseInt(r)+" 小时前":1<=e&&e<=59?" "+parseInt(e)+" 分钟前":0<=i&&i<=6e4?"刚刚":((a=new Date).setTime(t),o=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,n=a.getDate()<10?"0"+a.getDate():a.getDate(),a.getFullYear()+"-"+o+"-"+n)}document.querySelector(".copyright .author").setAttribute("data-content"," 载入中... "),document.querySelector(".copyright .author").classList.add("run-times"),document.hidden?clearInterval(siteTime):siteTime=setInterval("createTime()",900)</script></div></footer><script src="//cdnjs.cloudflare.com/ajax/libs/animejs/3.2.0/anime.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/lozad.js/1.15.0/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script>(()=>{var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)})()</script><script src="/js/local-search.js"></script><script>document.querySelectorAll(".pdfobject-container").forEach(e=>{var t=e.dataset.target,a="#"+Object.entries({navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"}).map(([e,t])=>e+"="+encodeURIComponent(t)).join("&"),r="/lib/pdf/web/viewer?file="+encodeURIComponent(t)+a;NexT.utils.supportsPDFs()?e.innerHTML=`<embed class="pdfobject" src="${t+a}" type="application/pdf" style="height: ${e.dataset.height};">`:e.innerHTML=`<iframe src="${r}" style="height: ${e.dataset.height};" frameborder="0"></iframe>`})</script><script>document.querySelectorAll(".mermaid").length&&NexT.utils.getScript("//cdnjs.cloudflare.com/ajax/libs/mermaid/8.7.0/mermaid.min.js",()=>{mermaid.init({theme:"forest",logLevel:3,flowchart:{curve:"linear"},gantt:{axisFormat:"%m/%d/%Y"},sequence:{actorMargin:50}},".mermaid")},window.mermaid)</script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>NexT.utils.loadComments("#valine-comments",()=>{NexT.utils.getScript("//cdnjs.cloudflare.com/ajax/libs/valine/1.4.18/Valine.min.js",()=>{new Valine(Object.assign({el:"#valine-comments",path:"/browser_more/"},{enable:!0,appId:"VyjoY5GEmoFvdbhOf43SAbBq-gzGzoHsz",appKey:"xndGDmxQC6VzUsixOrnUOqaa",placeholder:"评论支持Markdown与图片(复制粘贴即可)，昵称栏填写QQ号会自动获取昵称、头像和邮箱，填写邮箱的话会通过邮件联系您哦，期待您的留言！",avatar:"wavatar",meta:["nick","mail","link"],pageSize:10,lang:null,visitor:!1,comment_count:!0,recordIP:!1,serverURLs:null,enableQQ:!0,requiredFields:[],verify:!0}))},window.Valine)})</script><canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:99999;pointer-events:none"></canvas><script type="text/javascript" src="/js/anime.min.js"></script><script type="text/javascript" src="/js/fireworks.js"></script><script src="/js/activate-power-mode.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,document.body.addEventListener("input",POWERMODE)</script><style>footer.footer{overflow:visible;position:relative}#flyfish{position:absolute;width:100%;height:185px;line-height:0;left:0;bottom:0;margin:0;padding:0;z-index:-1}</style><script>var flyfish=document.createElement("div");flyfish.id="flyfish",document.querySelector("footer.footer").appendChild(flyfish)</script><script src="/js/flyfish.js"></script><img id="dark-theme-img" src="/images/bulb.png" alt="bulb"><script type="text/javascript">var div,brightness=0;function cover(e){void 0===div?((div=document.createElement("div")).setAttribute("style","position:fixed;top:0;left:0;outline:50000px solid;z-index:99999;"),document.body.appendChild(div)):div.style.display="",div.style.outlineColor="rgba(0,0,0,"+e+")"}window.addEventListener("keydown",function(e){e.altKey&&90===e.keyCode&&cover(brightness=.3),e.altKey&&88===e.keyCode&&cover(brightness=0),e.altKey&&38===e.keyCode&&.05<brightness-.05&&cover(brightness-=.05),e.altKey&&40===e.keyCode&&brightness+.05<.95&&cover(brightness+=.05)},!1);var darkImg=document.querySelector("#dark-theme-img");null!==darkImg&&(darkImg.setAttribute("title","【Alt+↑/↓】调节亮度哦～"),darkImg.addEventListener("click",function(){cover(brightness=0===brightness?.3:0)}))</script><script type="text/javascript">var titleTime,OriginTitle=document.title;document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState?(document.title=" Waiting for you. ",clearTimeout(titleTime)):(document.title=" Welcome back. "+OriginTitle,titleTime=setTimeout(function(){document.title=OriginTitle},2e3))})</script><script type="text/javascript">function consoleInfo(){if(console.log("%c%c 博客名称 %c DoubleAm ","line-height:28px;","line-height:28px;padding:4px;background:#a1afc9;color:#000;font-size:16px;margin-right:15px;","color:#3fa9f5;line-height:28px;font-size:16px;"),console.log("%c%c 我的简历 %c http://a.biugle.cn/resume ","line-height:28px;","line-height:28px;padding:4px;background:#a1afc9;color:#000;font-size:16px;margin-right:15px","color:#00bc12;line-height:28px;font-size:16px;"),console.log("%c%c 扣扣号码 %c 1005760694 ","line-height:28px;","line-height:28px;padding:4px;background:#a1afc9;color:#000;font-size:16px;margin-right:15px","color:#ff9900;line-height:28px;font-size:16px;"),console.log("%c%c 写歌的人断了魂啊，听歌的人最无情！  ","line-height:28px;","line-height:28px;padding:4px 0px;color:#fff;font-size:16px;color:chocolate;"),console.log("%c%c                    ——— 陈升 牡丹亭外 ","line-height:28px;","line-height:28px;padding:4px 0px;color:#fff;font-size:16px;color:chocolate;"),window.console&&window.console.log){console.log(`%c页面加载消耗了 %c${(Math.round(100*performance.now())/100/1e3).toFixed(2)}s`,"background: #fff;color: #333;text-shadow: 0 0 2px #eee, 0 0 3px #eee, 0 0 3px #eee, 0 0 2px #eee, 0 0 3px #eee;","color:tomato;font-weight:bolder;"),localStorage.getItem("access")||localStorage.setItem("access",(new Date).getTime());var o=new Date(parseInt(localStorage.getItem("access"))),o=`${o.getFullYear()}年${o.getMonth()+1}月${o.getDate()}日`;let e=0;localStorage.getItem("hit")?e=parseInt(localStorage.getItem("hit")):localStorage.setItem("hit",0),localStorage.setItem("hit",++e),console.log(`%c这是你自 %c${o} %c以来第 %c${e} %c次在本站打开控制台，你想知道什么秘密吗～`,"","color:chocolate;font-weight:bolder;","","color:chocolate;font-weight:bolder;","")}}consoleInfo()</script><script type="text/javascript">setWords()</script><style>[bg-lazy]{background-image:none!important;background-color:#eee!important}</style><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})})</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o=d[n],i=function(){d=d.filter(function(t){return o!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(o)};(t=o).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),i()):(e=new Image,a=t.getAttribute("data-original"),e.onload=function(){t.src=a,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),i()},e.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=a},t.src!==a&&(e.src=a)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this)</script></body></html>